**File:** `move-indiamed-api\APIAccessManagement\PropertyFiles\APIAcessMgmt.properties`

---

## 1. High‑Level Summary
This properties file supplies runtime configuration for the **API Access Management** component of the India‑MED data‑move platform. It defines the JDBC connection to the `Mediation_IndiaPOP_PROD` SQL Server database used for persisting API‑access control data, and it provides the SMTP settings for the component’s built‑in error‑notification mailer. The file is read at application start‑up (e.g., by `APIAccessDAO` or any class that loads `APIAcessMgmt.properties` from the classpath) and its values are cached for the lifetime of the Java process.

---

## 2. Important Keys & Their Responsibilities
| Key | Purpose | Typical Consumer |
|-----|---------|------------------|
| `db.url` | JDBC URL for the SQL Server instance (`INMPROXY01.tccspl.local:1433`) and target database (`Mediation_IndiaPOP_PROD`). Encryption is explicitly disabled (`encrypt=false`). | `java.sql.DriverManager` via DAO layer (`APIAccessDAO`). |
| `db.username` | Database login used by the DAO for all CRUD operations on API‑access tables. | DAO layer. |
| `db.password` | Plain‑text password for `db.username`. | DAO layer (used to build the JDBC connection). |
| `error_mail_to` | Primary recipient for automated error alerts generated by the component. | Mail utility invoked on exception handling. |
| `email_from` | Sender address used for the same alerts. | Mail utility. |
| `email_cc` | Optional carbon‑copy list (currently a single address). | Mail utility. |
| `mail_host` | SMTP host name; set to `localhost` meaning the local MTA is expected to relay outbound mail. | Mail utility. |

---

## 3. Inputs, Outputs, Side Effects & Assumptions
| Aspect | Detail |
|--------|--------|
| **Inputs** | - The JVM classpath must contain this file (or a path supplied via `-Dconfig.file`).<br>- The host `INMPROXY01.tccspl.local` must resolve and allow TCP/1433 traffic.<br>- Local SMTP service must be listening on port 25 (or default). |
| **Outputs** | - Successful DB connections returned to callers (e.g., `APIAccessDAO`).<br>- Email messages sent to `error_mail_to` on runtime failures. |
| **Side Effects** | - Creation of DB sessions that may hold locks if not closed properly.<br>- Generation of email traffic (potentially noisy if errors are frequent). |
| **Assumptions** | - SQL Server does **not** require TLS (`encrypt=false`).<br>- The service account `INDIA_AIS_PROD` has sufficient privileges on the `Mediation_IndiaPOP_PROD` schema.<br>- The local mail host is correctly configured to forward to external mail servers. |

---

## 4. Integration with Other Scripts / Components
| Component | Connection Point |
|-----------|------------------|
| `move-indiamed-api\APIAccessManagement\bin\APIAccessDAO.properties` | May reference the same DB credentials; the DAO implementation reads both property files to build its connection pool. |
| Java classes in `move-indiamed-api\APIAccessManagement\src\...` (e.g., `APIAccessDAO`, `ErrorNotifier`) | Load this file via `java.util.Properties` or a framework (Spring, Commons Configuration). |
| Hive DDL scripts (e.g., `traffic_aggr_adhoc.hql`) | Not directly linked, but the API Access Management component may be invoked by orchestration jobs that also run those Hive scripts, sharing the same execution environment (e.g., Oozie workflow). |
| Monitoring / alerting pipelines | Email addresses defined here are used by the component’s internal alerting; external monitoring tools may also parse logs generated by this component. |

---

## 5. Operational Risks & Recommended Mitigations
| Risk | Impact | Mitigation |
|------|--------|------------|
| **Plain‑text DB password** | Credential leakage if the file is exposed (e.g., via source control, backup). | Store credentials in a secret manager (Azure Key Vault, HashiCorp Vault) and inject at runtime; or encrypt the file and decrypt in the application. |
| **`encrypt=false` on JDBC URL** | Data in transit between the app and SQL Server is sent unencrypted, exposing sensitive information. | Enable TLS on the SQL Server instance and set `encrypt=true` (or remove the flag to use default). |
| **Hard‑coded SMTP host `localhost`** | If the local MTA fails, error alerts are lost, delaying incident response. | Configure a resilient external SMTP relay; make the host configurable per environment. |
| **Single static email recipient** | Alert fatigue or missed notifications if the address becomes invalid. | Use a distribution list or integrate with a ticketing system (e.g., ServiceNow) via API. |
| **No connection pooling parameters** | Potential resource exhaustion under load. | Add pool size, timeout, and validation query settings (e.g., via HikariCP config). |

---

## 6. Running / Debugging the Component
1. **Ensure the file is on the classpath**  
   ```bash
   export CONFIG_DIR=/opt/indiamed-api/APIAccessManagement/PropertyFiles
   java -cp "$CONFIG_DIR:$(./build-classpath.sh)" com.tata.indiamed.api.Main
   ```
   *Alternatively, pass the location explicitly:*  
   ```bash
   java -Dconfig.file=$CONFIG_DIR/APIAcessMgmt.properties -jar api-access-management.jar
   ```

2. **Validate DB connectivity**  
   ```bash
   java -cp $CONFIG_DIR com.tata.indiamed.api.TestDBConnection
   ```
   The test class should log “Connection successful” or print the exception stack trace.

3. **Test email alerting**  
   ```bash
   java -cp $CONFIG_DIR com.tata.indiamed.api.TestMailSender
   ```
   Verify receipt at `error_mail_to`.

4. **Debugging**  
   - Enable DEBUG logging in `log4j.properties` (set `log4j.logger.com.tata.indiamed=DEBUG`).  
   - Watch for `PropertiesLoader` messages indicating which file was loaded and the resolved values (password will be masked if logging is configured securely).  
   - Use a JDBC profiler (e.g., `p6spy`) to confirm the connection string and encryption flag.

---

## 7. External References & Dependencies
| File / Resource | Role |
|-----------------|------|
| `move-indiamed-api\APIAccessManagement\bin\APIAccessDAO.properties` | May contain additional DAO‑specific settings (pool size, retry policy). |
| `log4j.properties` (same module) | Controls logging output; useful for tracing property loading and error handling. |
| SQL Server `Mediation_IndiaPOP_PROD` | Target database for API‑access tables. |
| Local SMTP service (`localhost`) | Sends alert e‑mails; must be reachable from the application host. |
| Environment variables (optional) | Some deployments override properties via `-D` JVM flags; check startup scripts for `DB_URL`, `DB_USER`, etc. |

---

## 8. Suggested TODO / Improvements
1. **Secure Credential Management** – Migrate `db.username` / `db.password` to a vault solution and modify the DAO to retrieve them at runtime (e.g., via Spring Cloud Config or Azure Key Vault).  
2. **Enable TLS for DB Connections** – Update `db.url` to `encrypt=true` (or remove the flag) and ensure the SQL Server instance has a valid certificate; add a fallback to verify encryption during startup.  

---