# Summary
`MNAAS_ShellScript.properties` supplies environment‑specific connection parameters and operational constants for the **BalanceNotfHandler** batch job. It defines Oracle source database credentials (test environment), Impala/Hive endpoints, e‑mail routing, and Kafka broker details used by shell scripts and Java components during data extraction, transformation, and loading of balance‑update events.

# Key Components
- **Oracle DB connection properties** (`ora_*`) – target Move database for balance data extraction.  
- **Impala/Hive connection properties** (`IMPALAD_HOST`, `IMPALAD_JDBC_PORT`) – destination Hive warehouse for persisting balance updates.  
- **Mail configuration** (`movegbs_mail_*`) – SMTP host and address fields for notification e‑mails generated by the job.  
- **Kafka broker configuration** (`kafka_server`, `kafka_port`) – broker used by the job to publish/consume balance‑update messages.  

# Data Flow
| Step | Input | Process | Output / Side‑Effect |
|------|-------|---------|----------------------|
| 1 | Oracle DB (test) | JDBC query executed by DAO (`MOVEDAO.properties`) to fetch raw balance events. | Result set streamed to Java loader. |
| 2 | Result set | Transformation & enrichment in `BalanceNotfHandler` Java code. | Prepared INSERT statements for Hive. |
| 3 | Hive (Impala) | JDBC connection using `IMPALAD_HOST:IMPALAD_JDBC_PORT` to execute `insert.balance`. | Rows persisted in `mnaas.api_balance_update`. |
| 4 | Kafka | Optional publish of balance‑update messages to `kafka_server:kafka_port`. | Messages available for downstream consumers. |
| 5 | Mail | On success/failure, e‑mail composed using `movegbs_mail_*` settings. | Notification sent via `movegbs_mail_host`. |

# Integrations
- **`MOVEDAO.properties`** – reads `insert.balance` SQL; uses Oracle credentials from this file.  
- **`log4j.properties`** – logging configuration for the same component; no direct reference but shares runtime classpath.  
- **Java classes** in `move-mediation-bal-notification` (e.g., DAO, loader, handler) read this properties file via `java.util.Properties`.  
- **Shell scripts** that launch the batch job source this file to export environment variables for the JVM (`-D` system properties).  

# Operational Risks
- **Plain‑text credentials** – exposure of Oracle passwords; mitigate by encrypting or using a secrets manager.  
- **Hard‑coded test DB** – accidental execution against production if comments are removed; enforce environment validation in startup scripts.  
- **Static Kafka broker** – single point of failure; add broker list and enable client retries.  
- **Mail host hard‑coded** – if SMTP changes, job fails; externalize to a configurable property file.  

# Usage
```bash
# Export properties as JVM system properties (example)
export PROPS_FILE=move-mediation-bal-notification/BalanceNotfHandler/MNAAS_Property_Files/MNAAS_ShellScript.properties
java -cp <classpath> \
  -Dconfig.file=$PROPS_FILE \
  com.tcl.move.balance.BalanceNotfHandlerMain \
  --date=$(date +%Y-%m-%d)
```
To debug, set `log4j.rootLogger=DEBUG` in `log4j.properties` and verify loaded values via:
```java
Properties p = new Properties();
p.load(new FileInputStream(System.getProperty("config.file")));
System.out.println(p.getProperty("ora_serverNameMOVE"));
```

# configuration
- **File**: `MNAAS_ShellScript.properties` (must be on classpath or supplied via `-Dconfig.file`).  
- **Referenced files**: `MOVEDAO.properties` (SQL), `log4j.properties` (logging).  
- **Environment variables** (optional): `JAVA_OPTS`, `LOG_DIR`.  

# Improvements
1. **Secure credentials** – replace clear‑text Oracle passwords with encrypted values or integrate with a vault (e.g., HashiCorp Vault, AWS Secrets Manager).  
2. **Environment segregation** – externalize environment selection (DEV/TEST/PROD) to a variable and load the appropriate block programmatically, eliminating commented‑out sections.