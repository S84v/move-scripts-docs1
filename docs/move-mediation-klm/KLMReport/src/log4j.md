# Summary
`log4j.properties` configures Log4j 1.x for the KLMReport component. It establishes a root logger at **INFO** level with two appenders: a `DailyRollingFileAppender` that writes to the file defined by the `${logfile.name}` system property, and a `ConsoleAppender` that writes to `System.out`. All log events are formatted with a common pattern and emitted to both destinations during production execution.

# Key Components
- **log4j.rootLogger** – Sets global log level (`INFO`) and attaches the `File` and `stdout` appenders.  
- **log4j.appender.File** – `org.apache.log4j.DailyRollingFileAppender` writing to `${logfile.name}`; uses `PatternLayout`.  
- **log4j.appender.File.layout** – `org.apache.log4j.PatternLayout` with conversion pattern `[%‑5p] %d{ISO8601} %c - %m%n`.  
- **log4j.appender.stdout** – `org.apache.log4j.ConsoleAppender` targeting `System.out`; same layout as file appender.  

# Data Flow
| Element | Direction | Description |
|---------|-----------|-------------|
| Application log statements | → Log4j framework | Generated by Java classes throughout KLMReport. |
| Log4j → File appender | → `${logfile.name}` file | Daily‑rolled log file stored on the host filesystem. |
| Log4j → Console appender | → `System.out` (STDOUT) | Visible in the process console / container logs. |
| Side effects | – | File creation, daily rollover, potential disk I/O. |
| External services | – | None directly; logs may be harvested by log aggregation (e.g., Splunk, ELK) via STDOUT or file tailing. |

# Integrations
- **KLMReport Java code** – Implicitly loads `log4j.properties` from the classpath at startup; all classes using `org.apache.log4j.Logger` inherit this configuration.  
- **Shell/Orchestration scripts** – Must supply the `-Dlogfile.name=<path>` JVM argument so the file appender resolves a concrete target.  
- **Monitoring/Alerting pipelines** – Consume STDOUT or the rolled log files for health checks and error detection.  

# Operational Risks
- **Missing `logfile.name` property** → Log4j fails to create file appender; only console output remains. *Mitigation*: enforce JVM argument via wrapper scripts; fallback default path.  
- **Insufficient file system permissions** → Log rotation or write failures, leading to lost logs. *Mitigation*: provision dedicated log directory with appropriate ACLs.  
- **Unbounded log growth** – Daily rolling without size limit may exhaust disk. *Mitigation*: add retention policy (e.g., delete files > 30 days) or switch to `RollingFileAppender` with size caps.  
- **Log level too verbose for production** → INFO may still generate high volume. *Mitigation*: adjust to WARN/ERROR for stable releases; make level configurable via env var.  

# Usage
```bash
# Example JVM launch
java -Dlogfile.name=/var/log/klmreport/klmreport.log \
     -Dlog4j.configuration=file:/opt/move-mediation-klm/KLMReport/src/log4j.properties \
     -cp <classpath> com.company.klmreport.Main
```
*Debug*: Set `log4j.rootLogger=DEBUG, File, stdout` temporarily and restart the process; observe output on console and in the specified log file.

# Configuration
- **System Property** `logfile.name` – Full path to the daily‑rolling log file.  
- **Classpath location** `log4j.properties` – Must be reachable (e.g., `src/log4j.properties` or packaged in JAR).  
- **Pattern** – Hard‑coded in the file; can be overridden only by editing the properties file.  

# Improvements
1. **Migrate to Log4j 2.x** – Gain asynchronous logging, better configurability, and native JSON layout for downstream log pipelines.  
2. **Externalize layout and rollover policy** – Move pattern and retention settings to environment‑specific property files or system properties to avoid code changes for log tuning.