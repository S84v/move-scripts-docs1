# Summary
`MNAAS_Table_Space_Monitoring.properties` is a Bash‑sourced configuration fragment used by the `MNAAS_Table_Space_Monitoring.sh` script in the MNAAS telecom mediation pipeline. It establishes runtime constants for logging, process‑status tracking, and script identification, and imports shared common properties from `MNAAS_CommonProperties.properties`. The script monitors Oracle/Hive table‑space usage and reports status to the MNAAS operations team.

# Key Components
- **Source Inclusion**: `. /app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_CommonProperties.properties` – imports shared environment variables (e.g., `MNAASLocalLogPath`, `MNAASConfPath`).
- **MNAAS_Table_Space_Monitoring_Scriptname** – constant holding the script filename.
- **MNAAS_Table_Space_Monitoring_logpath** – full path to the daily log file, suffixed with the execution date.
- **MNAAS_Table_Space_Monitoring_ProcessStatusFilename** – full path to the process‑status file used for idempotency and monitoring.

# Data Flow
| Element | Direction | Description |
|---------|-----------|-------------|
| **Input** | Environment variables from `MNAAS_CommonProperties.properties` | Paths, Hadoop/Hive configuration, Oracle connection strings. |
| **Input** | Oracle/Hive metadata (via script) | Table‑space size, free space, growth trends. |
| **Output** | Log file (`MNAAS_Table_Space_Monitoring.log_YYYY-MM-DD`) | Detailed execution trace, warnings, errors. |
| **Output** | Process‑status file (`*_ProcessStatusFile`) | JSON/flat‑file flag indicating success, failure, or skip. |
| **Side Effect** | Optional alert/notification (email/Slack) generated by the script based on thresholds. |
| **External Services** | Oracle DB (via Sqoop/JDBC) | Reads table‑space statistics. |
| **External Services** | HDFS/Hive/Impala | May write intermediate metrics to staging tables. |

# Integrations
- **MNAAS_CommonProperties.properties** – provides base paths (`MNAASLocalLogPath`, `MNAASConfPath`) and common DB connection settings.
- **MNAAS_Table_Space_Monitoring.sh** – consumes the constants defined here; invoked by the daily cron or Airflow DAG for the MNAAS move pipeline.
- **Monitoring/Alerting subsystem** – reads the process‑status file to trigger alerts if the script reports a failure or threshold breach.
- **Orchestration layer (e.g., Oozie/Airflow)** – references the script name and status file to determine downstream job eligibility.

# Operational Risks
- **Path Misconfiguration** – If `MNAASLocalLogPath` or `MNAASConfPath` are incorrect, logs and status files are not written, leading to silent failures. *Mitigation*: Validate paths at script start; exit with error if missing.
- **Date Formatting Edge Cases** – Log filename uses `date +_%F`; locale or system date misconfiguration could produce unexpected filenames. *Mitigation*: Enforce UTC and explicit `LC_ALL=C`.
- **Process‑Status File Staleness** – Stale status files may cause downstream jobs to assume success. *Mitigation*: Include timestamp in the file and enforce freshness checks in orchestrator.
- **Dependency on Common Properties** – Changes in `MNAAS_CommonProperties.properties` can break this script. *Mitigation*: Version‑control the common file and run regression tests on changes.

# Usage
```bash
# Load configuration
source /app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_Table_Space_Monitoring.properties

# Execute the monitoring script (normally via cron or scheduler)
bash $MNAASConfPath/../MNAAS_Table_Space_Monitoring.sh

# Debug: print resolved variables
echo "Log: $MNAAS_Table_Space_Monitoring_logpath"
echo "Status: $MNAAS_Table_Space_Monitoring_ProcessStatusFilename"
```

# Configuration
- **Environment Variables (inherited from `MNAAS_CommonProperties.properties`)**
  - `MNAASLocalLogPath` – Base directory for local logs.
  - `MNAASConfPath` – Directory containing configuration files.
  - Additional DB connection vars (e.g., `ORACLE_USER`, `ORACLE_PASS`, `HIVE_METASTORE_URI`).
- **Local Config File**
  - `MNAAS_Table_Space_Monitoring.properties` – defines script‑specific constants.

# Improvements
1. **Add Validation Logic** – Embed a function to verify that `$MNAASLocalLogPath` and `$MNAASConfPath` exist and are writable before script execution.
2. **Externalize Thresholds** – Move table‑space warning/critical thresholds to a separate properties file to allow runtime tuning without script modification.