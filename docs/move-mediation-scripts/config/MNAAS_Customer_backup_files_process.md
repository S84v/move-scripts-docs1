# Summary
`MNAAS_Customer_backup_files_process.properties` defines runtime configuration for the **MNAAS_Customer_backup_files_process** Bash pipeline. It loads common properties, sets script metadata, declares associative arrays mapping file‑type patterns to backup directories, and dynamically extends those mappings for newly‑onboarded customers defined in `MNAAS_Create_New_Customers.properties`. The file is sourced by the processing script to drive file selection, HDFS staging, and backup placement during a telecom production move.

# Key Components
- **`MNAAS_Customer_backup_files_process_Scriptname`** – Name of the executable Bash script.  
- **`MNAAS_Customer_backup_files_process_ProcessStatusFileName`** – Path to status file written by the script.  
- **`MNAAS_Customer_backup_files_process_logpath`** – Log file location (timestamped).  
- **`MNAAS_Customer_backup_file_process_filename`** – CSV manifest generated by the script.  
- **`MNAAS_backup_files_process_file_pattern`** – Associative array mapping logical data groups (`traffic`, `activations`, …) to glob patterns.  
- **`MNAAS_backup_files_process_backup_dir`** – Associative array mapping customer identifiers to their primary backup directory.  
- **`MNAAS_backup_files_edgenode2_backup_dir`** – Same mapping for the secondary edge node (`edge2node`).  
- **Dynamic population loops** – Read `MNAAS_Create_New_Customers.properties` and add missing customers to both backup‑dir maps, with duplicate‑entry guard.

# Data Flow
| Stage | Input | Processing | Output / Side‑Effect |
|-------|-------|------------|----------------------|
| Load common props | `/app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_CommonProperties.properties` | `source` (environment variables) | Variables such as `MNAASConfPath`, `MNAASLocalLogPath`, `dbname` become available. |
| Customer list | `MNAAS_Create_New_Customers` (properties file) | `while IFS='|' read -r new_customer _` loops | New entries added to `MNAAS_backup_files_process_backup_dir` and `MNAAS_backup_files_edgenode2_backup_dir`. |
| File pattern lookup | `MNAAS_backup_files_process_file_pattern` | Bash/awk scripts use pattern to `find`/`cp` files | Selected CSV files are copied to the appropriate backup directory. |
| Manifest generation | Processed files | Script writes `$MNAAS_Customer_backup_file_process_filename` (CSV) | Record of processed files for downstream HDFS ingestion. |
| Status tracking | Script execution | Writes to `$MNAAS_Customer_backup_files_process_ProcessStatusFileName` | Enables monitoring/retry logic. |
| Logging | All steps | Appends to `$MNAAS_Customer_backup_files_process.log_<date>` | Auditable trace. |

External services:
- **HDFS** – Target path `/user/MNAAS/FileCount/customer_data` referenced for record‑count tables.
- **Hive** – Refresh command `refresh $dbname.$customers_files_records_count_tblname`.
- **Edge node** – `edge2node` host used by downstream copy jobs.

# Integrations
- **`MNAAS_Customer_backup_files_process.sh`** – Primary consumer; sources this properties file at start.  
- **`MNAAS_CommonProperties.properties`** – Provides base environment (paths, DB name).  
- **`MNAAS_Create_New_Customers.properties`** – Source of dynamic customer list; may be regenerated by upstream provisioning scripts.  
- **Hive scripts** – Use `customer_files_record_count_tblname_refresh` to sync record counts after backup.  
- **Monitoring/Orchestration** – Status file and log are polled by Ops dashboards (e.g., Nagios, Grafana).  

# Operational Risks
- **Duplicate customer entries** – If the source properties file contains duplicate names, the script silently skips but may leave expected directories uncreated. *Mitigation*: enforce uniqueness upstream or add validation step.  
- **Missing glob pattern** – New data types not added to `MNAAS_backup_files_process_file_pattern` result in files not being backed up. *Mitigation*: unit test pattern map after each release.  
- **Hard‑coded edge node hostname** – `edge2node` may become stale. *Mitigation*: externalize to a config file or DNS alias.  
- **File‑system permission errors** – Backup path `/backup1/MNAAS/Customer_CDR/` must be writable by the script user. *Mitigation*: pre‑run permission audit.  

# Usage
```bash
# Source the properties (normally done inside the script)
source /app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_Customer_backup_files_process.properties

# Run the processing script (example)
bash $MNAAS_Customer_backup_files_process_Scriptname \
    --conf $MNAAS_Customer_backup_files_process_ProcessStatusFileName \
    --log  $MNAAS_Customer_backup_files_process_logpath
```
*Debug*: set `set -x` inside the script or export `DEBUG=1` to print associative array contents.

# Configuration
- **Environment variables** (in `MNAAS_CommonProperties.properties`):  
  - `MNAASConfPath` – Directory containing all `.properties` files.  
  - `MNAASLocalLogPath` – Base log directory.  
  - `dbname` – Hive database name.  
- **Referenced config files**:  
  - `MNAAS_Create_New_Customers.properties` – Customer list.  
  - `MNAAS_CommonProperties.properties` – Global defaults.  
- **Hard‑coded constants**:  
  - `backup_path=/backup1/MNAAS/Customer_CDR/`  
  - `edge2node=camttppap002.intl.vsnl.co.in`  

# Improvements
1. **Validate customer list schema** – Add a pre‑load check that each line contains exactly three fields (`Customer|Pattern|HOL_ID`) and that `Customer` is unique.  
2. **Externalize edge node & backup root** – Move `edge2node` and `backup_path` into a dedicated `MNAAS_Infrastructure.properties` file to avoid code changes when infrastructure shifts.