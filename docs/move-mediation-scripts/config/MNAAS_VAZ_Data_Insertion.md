# Summary
Defines Bash‑sourced runtime constants for the **MNAAS_VAZ_Data_Insertion** job, which ingests daily PGW latitude/longitude CSV files into HDFS, loads them into intermediate Hive tables, and persists the data into a MySQL VAZ table via Java loader classes. Includes process‑status tracking, logging, HDFS paths, Java class names, and retention policy.

# Key Components
- **MNAAS_Vaztable_Load_Raw_ProcessStatusFileName** – HDFS file that records job status (STARTED, SUCCESS, FAIL).  
- **MNAAS_VAZ_Data_InsertionLogPath** – Local log file path with date suffix.  
- **MNAASDailyTrafficDetailsLoadAggrSriptName** – Shell script (`MNAAS_vaz_data_insertion.sh`) executed by the scheduler.  
- **Dname_MNAAS_VAZ_Data_Insertion_Temp**, **Dname_MNAAS_Insert_Daily_vaz_tbl** – Hive database names for staging and final tables.  
- **MNAAS_Local_Input_PATH** – HDFS glob pattern for source CSV files (`*PGW*.csv`).  
- **MNAAS_VAZ_HDFS_PATH** – HDFS target directory for uploaded CSVs.  
- **VAZ_weekly_inter_tblname**, **VAZ_weekly_tblname** – Hive table names for intermediate and final VAZ data.  
- **Insert_Weekly_table** – Java class `com.tcl.mnass.tableloading.LatLongTableLoading` (loads intermediate table).  
- **Insert_VAZ_Weekly_table** – Java class `com.tcl.conn.MYSQLConnection` (writes final data to MySQL).  
- **VAZ_IP_ADDRESS**, **VAZ_PORT_NUMBER** – MySQL endpoint.  
- **MNAAS_Local_Input_Filename** – Daily generated CSV filename pattern.  
- **VAZ_control_file** – Path to auxiliary control properties.  
- **Tablename** – MySQL target table `v_cellIdlocation`.  
- **Daily_Telena_BackupDir** – Local backup directory for raw files.  
- **mnaas_retention_period_vaz_details_raw_daily** – Hive table retention (days).

# Data Flow
1. **Input**: CSV files matching `/Input_Data_Staging/MNAAS_DailyFiles/*PGW*.csv` (generated by upstream PGW processes).  
2. **Upload**: Files copied to HDFS path `$MNAAS_VAZ_HDFS_PATH`.  
3. **Staging**: Data loaded into Hive table `vaz_details_inter_raw_daily` (`VAZ_weekly_inter_tblname`).  
4. **Refresh**: Hive metadata invalidated via `invalidate metadata mnaas.vaz_details_inter_raw_daily`.  
5. **Aggregation**: Java loader `LatLongTableLoading` processes staging table and writes to `vaz_details_raw_daily`.  
6. **Refresh**: Hive metadata invalidated for final table.  
7. **Export**: Java `MYSQLConnection` reads final Hive table and inserts rows into MySQL `v_cellIdlocation` on `10.171.102.11:3306`.  
8. **Backup**: Original CSVs archived to `$Daily_Telena_BackupDir`.  
9. **Status**: Job status written to `$MNAAS_Vaztable_Load_Raw_ProcessStatusFileName`.  
10. **Logging**: Execution details appended to `$MNAAS_VAZ_Data_InsertionLogPath`.

# Integrations
- **MNAAS_CommonProperties.properties** – Provides base paths (`MNAASConfPath`, `MNAASLocalLogPath`, etc.).  
- **VAZCntrlFile.properties** – Supplies additional control parameters for the Java loaders.  
- **Hive Metastore** – Used for table creation, refresh, and queries.  
- **HDFS** – Storage for raw CSVs and intermediate tables.  
- **MySQL** – Destination for final VAZ data.  
- **Scheduler (e.g., Oozie/Cron)** – Triggers `MNAAS_vaz_data_insertion.sh` using the defined constants.  

# Operational Risks
- **Missing Input Files** – Job will fail if no `*PGW*.csv` present. *Mitigation*: Pre‑run validation step; alert on empty input glob.  
- **HDFS Permission Errors** – Upload or staging may be blocked. *Mitigation*: Ensure service account has write access to `$MNAAS_VAZ_HDFS_PATH`.  
- **Hive Metadata Staleness** – Failure to invalidate metadata can cause stale reads. *Mitigation*: Verify refresh commands execute successfully; add retry logic.  
- **MySQL Connectivity** – Network or credential issues prevent final load. *Mitigation*: Store credentials securely; implement connection timeout and retry.  
- **Retention Overrun** – Accumulated raw daily tables may exceed storage. *Mitigation*: Schedule periodic Hive `DROP TABLE` based on `mnaas_retention_period_vaz_details_raw_daily`.  

# Usage
```bash
# Source common properties
. /app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_CommonProperties.properties

# Source this job's constants
. /app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_VAZ_Data_Insertion.properties

# Execute the job script (debug mode optional)
bash $MNAASDailyTrafficDetailsLoadAggrSriptName   # runs MNAAS_vaz_data_insertion.sh
```
To enable verbose debugging, uncomment the `set -x` line inside the script (if present) or set `set -x` before invoking.

# Configuration
- **Environment Variables** (populated by `MNAAS_CommonProperties.properties`):  
  - `MNAASConfPath`  
  - `MNAASLocalLogPath`  
- **Referenced Config Files**:  
  - `/app/hadoop_users/MNAAS/MNAAS_Property_Files/MNAAS_CommonProperties.properties`  
  - `/app/hadoop_users/MNAAS/MNAAS_Property_Files/VazCntrlFile.properties`  
- **Hard‑coded Constants**: IP `10.171.102.11`, port `3306`, Hive DB names, table names, retention period.

# Improvements
1. **Parameterize MySQL credentials** – Move `VAZ_IP_ADDRESS`, `VAZ_PORT_NUMBER`, user, and password to a secure vault (e.g., Hadoop Credential Provider) instead of plain text.  
2. **Add idempotent checkpointing** – Write a checkpoint file after each stage (HDFS upload, Hive load, MySQL insert) to allow safe re‑run on failure without duplicate processing.